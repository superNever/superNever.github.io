<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8" />
  
  <title>promise | supernever</title>
  <meta name="author" content="supernever" />

  
  <meta name="description" content="ç®€å•ä»‹ç»ä¸€ä¸‹promise" />
  

  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

  <meta property="og:title" content="promise" />
  <meta property="og:site_name" content="supernever" />

  
  

  
    <meta property="og:image" content="undefined" />
  

  
  <link href="/css/images/favicon.ico" rel="icon" />
  

  <link rel="alternate" href="/atom.xml" title="supernever" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  


  <!-- baidu webmaster push -->
  <script src='//push.zhanzhang.baidu.com/push.js'></script>

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">supernever</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2017-01-24T03:11:13.000Z"><a href="/2017/01/24/promise/">2017-01-24</a></time>
      
      
  
    <h1 class="title">promise</h1>
  

    </header>
    <div class="entry">
      
        <p>ç®€å•ä»‹ç»ä¸€ä¸‹promise<br><a id="more"></a></p>
<h3 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="headerlink" title="åŸºæœ¬ç”¨æ³•"></a>åŸºæœ¬ç”¨æ³•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">let</span> promise = new Promise((resolve,reject)=<span class="arrow-right">&gt;</span>&#123;</div><div class="line">    /**ä¸šåŠ¡å¤„ç†**/</div><div class="line">    resolve(/**data**/);</div><div class="line">&#125;)</div><div class="line">promise.then((data)=<span class="arrow-right">&gt;</span>&#123;</div><div class="line">    /**æ•°æ®å¤„ç†**/</div><div class="line">&#125;).catch((err)=<span class="arrow-right">&gt;</span>&#123;</div><div class="line">    /**é”™è¯¯å¤„ç†**/</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="promiseå¸¸è§„ç”¨æ³•"><a href="#promiseå¸¸è§„ç”¨æ³•" class="headerlink" title="promiseå¸¸è§„ç”¨æ³•"></a>promiseå¸¸è§„ç”¨æ³•</h3><ul>
<li>promise.then</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">var promise = new Promise(resolve,reject)&#123;</div><div class="line">    resolve(<span class="string">'ä¼ é€’ç»™thençš„å€¼'</span>)</div><div class="line">&#125;</div><div class="line">promise.then(<span class="keyword">function</span>(data)&#123;</div><div class="line">    console.log(data);</div><div class="line">&#125;,<span class="keyword">function</span>(error)&#123;</div><div class="line">    console.log(error);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<ul>
<li>promise.catch</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">var promise = new Promise(<span class="keyword">function</span>(resolve, reject)&#123;</div><div class="line">    resolve(<span class="string">"ä¼ é€’ç»™thençš„å€¼"</span>);</div><div class="line">&#125;);</div><div class="line">promise.then(<span class="keyword">function</span> (value) &#123;</div><div class="line">    console.log(value);</div><div class="line">&#125;).catch(<span class="keyword">function</span> (error) &#123;</div><div class="line">    console.error(error);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<ul>
<li>promise.resolve</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> asyncTask(name)&#123;</div><div class="line">    <span class="built_in">return</span> Promise.resolve(name).then(<span class="keyword">function</span>(value)&#123;</div><div class="line">        <span class="built_in">return</span> <span class="string">"Done"</span>+value</div><div class="line">    &#125;)</div><div class="line">&#125;</div><div class="line">var taskName = <span class="string">"task 1"</span>;</div><div class="line">asyncTask(taskName).then(<span class="keyword">function</span>(value)&#123;</div><div class="line">    console.log(value)</div><div class="line">&#125;).catch(<span class="keyword">function</span>(err)&#123;</div><div class="line">    console.log(err);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<ul>
<li>promise.reject</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">var r = Promise.reject(new Error(<span class="string">'err'</span>))</div></pre></td></tr></table></figure>
<ul>
<li>promise.all</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">var p1 = Promise.resolve(1),</div><div class="line">    p2 = Promise.resolve(2),</div><div class="line">    p3 = Promise.resolve(3);</div><div class="line">Promise.all([p1, p2, p3]).then(<span class="keyword">function</span> (results) &#123;</div><div class="line">    console.log(results);  // [1, 2, 3]</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<ul>
<li>promise.race</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">var p1 = Promise.resolve(1),</div><div class="line">    p2 = Promise.resolve(2),</div><div class="line">    p3 = Promise.resolve(3);</div><div class="line">Promise.race([p1, p2, p3]).then(<span class="keyword">function</span> (results) &#123;</div><div class="line">    console.log(results);  // [1]</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="Promise-resolve"><a href="#Promise-resolve" class="headerlink" title="Promise.resolve()"></a>Promise.resolve()</h3><p><em>Promise.reject(error)æ˜¯å’Œ Promise.resolve(value) ç±»ä¼¼çš„<mark>é™æ€æ–¹æ³•</mark>ï¼Œæ˜¯ new Promise() æ–¹æ³•çš„å¿«æ·æ–¹å¼ã€‚</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">    Promise.resolve(42).then(<span class="keyword">function</span>(value)&#123;</div><div class="line">    console.log(value);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<blockquote>
<p>ç®€å•æ€»ç»“ä¸€ä¸‹ Promise.resolve æ–¹æ³•çš„è¯ï¼Œå¯ä»¥è®¤ä¸ºå®ƒçš„ä½œç”¨å°±æ˜¯å°†ä¼ é€’ç»™å®ƒçš„å‚æ•°å¡«å……ï¼ˆFulfilledï¼‰åˆ°promiseå¯¹è±¡åå¹¶è¿”å›è¿™ä¸ªpromiseå¯¹è±¡ã€‚<br>æ­¤å¤–ï¼ŒPromiseçš„å¾ˆå¤šå¤„ç†å†…éƒ¨ä¹Ÿæ˜¯ä½¿ç”¨äº† Promise.resolve ç®—æ³•å°†å€¼è½¬æ¢ä¸ºpromiseå¯¹è±¡åå†è¿›è¡Œå¤„ç†çš„ã€‚</p>
</blockquote>
<h3 id="Promise-reject"><a href="#Promise-reject" class="headerlink" title="Promise.reject()"></a>Promise.reject()</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Promise.reject(new Error(<span class="string">"å‡ºé”™äº†"</span>))</div><div class="line">//æ˜¯ä¸‹é¢ä»£ç çš„è¯­æ³•ç³–</div><div class="line">new Promise(<span class="keyword">function</span>(resolve,reject)&#123;</div><div class="line">    reject(new Error(<span class="string">"å‡ºé”™äº†"</span>));</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<blockquote>
<p>å®ƒå’ŒPromise.resolve(value) çš„ä¸åŒä¹‹å¤„åœ¨äºpromiseå†…è°ƒç”¨çš„å‡½æ•°æ˜¯rejectè€Œä¸æ˜¯resolveï¼Œè¿™åœ¨ç¼–å†™æµ‹è¯•ä»£ç æˆ–è€…è¿›è¡Œdebugæ—¶ï¼Œè¯´ä¸å®šä¼šç”¨å¾—ä¸Šã€‚</p>
</blockquote>
<h3 id="å‡ ä¸ªå¾ˆé‡è¦çš„åŸåˆ™é—®é¢˜"><a href="#å‡ ä¸ªå¾ˆé‡è¦çš„åŸåˆ™é—®é¢˜" class="headerlink" title="å‡ ä¸ªå¾ˆé‡è¦çš„åŸåˆ™é—®é¢˜"></a>å‡ ä¸ªå¾ˆé‡è¦çš„åŸåˆ™é—®é¢˜</h3><ul>
<li><p>ç»å¯¹ä¸èƒ½å¯¹å¼‚æ­¥å›è°ƒå‡½æ•°ï¼ˆå³ä½¿åœ¨æ•°æ®å·²ç»å°±ç»ªï¼‰è¿›è¡ŒåŒæ­¥è°ƒç”¨ã€‚</p>
</li>
<li><p>å¦‚æœå¯¹å¼‚æ­¥å›è°ƒå‡½æ•°è¿›è¡ŒåŒæ­¥è°ƒç”¨çš„è¯ï¼Œå¤„ç†é¡ºåºå¯èƒ½ä¼šä¸é¢„æœŸä¸ç¬¦ï¼Œå¯èƒ½å¸¦æ¥æ„æ–™ä¹‹å¤–çš„åæœã€‚</p>
</li>
<li><p>å¯¹å¼‚æ­¥å›è°ƒå‡½æ•°è¿›è¡ŒåŒæ­¥è°ƒç”¨ï¼Œè¿˜å¯èƒ½å¯¼è‡´æ ˆæº¢å‡ºæˆ–å¼‚å¸¸å¤„ç†é”™ä¹±ç­‰é—®é¢˜ã€‚</p>
</li>
<li><p>å¦‚æœæƒ³åœ¨å°†æ¥æŸæ—¶åˆ»è°ƒç”¨å¼‚æ­¥å›è°ƒå‡½æ•°çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ setTimeout ç­‰å¼‚æ­¥APIã€‚</p>
</li>
</ul>
<p><strong>ç®€å•ä¸€å¥è¯ï¼šPromiseåªèƒ½ä½¿ç”¨å¼‚æ­¥è°ƒç”¨æ–¹å¼ ã€‚</strong></p>
<ul>
<li><p>ä¸åˆæ³•çš„è°ƒç”¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> onReady(fn) &#123;</div><div class="line">    var readyState = document.readyState;</div><div class="line">    <span class="keyword">if</span> (readyState === <span class="string">'interactive'</span> || readyState === <span class="string">'complete'</span>) &#123;</div><div class="line">        fn();</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        window.addEventListener(<span class="string">'DOMContentLoaded'</span>, fn);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">onReady(<span class="function"><span class="title">function</span></span> () &#123;</div><div class="line">    console.log(<span class="string">'DOM fully loaded and parsed'</span>);</div><div class="line">&#125;);</div><div class="line">console.log(<span class="string">'==Starting=='</span>);</div><div class="line">//æ§åˆ¶å°æ‰“å°</div><div class="line">DOM fully loaded and parsed</div><div class="line">==Starting==</div></pre></td></tr></table></figure>
</li>
<li><p>ç¬¦åˆè§„èŒƒ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> onReady(fn) &#123;</div><div class="line">    var readyState = document.readyState;</div><div class="line">    <span class="keyword">if</span> (readyState === <span class="string">'interactive'</span> || readyState === <span class="string">'complete'</span>) &#123;</div><div class="line">        <span class="built_in">set</span>Timeout(fn, 0);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        window.addEventListener(<span class="string">'DOMContentLoaded'</span>, fn);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">onReady(<span class="function"><span class="title">function</span></span> () &#123;</div><div class="line">    console.log(<span class="string">'DOM fully loaded and parsed'</span>);</div><div class="line">&#125;);</div><div class="line">console.log(<span class="string">'==Starting=='</span>);</div><div class="line">//æ§åˆ¶å°æ‰“å°</div><div class="line"></div><div class="line"><span class="arrow-left">&lt;</span>mark<span class="arrow-right">&gt;</span>Starting<span class="arrow-left">&lt;</span>/mark<span class="arrow-right">&gt;</span></div><div class="line">DOM fully loaded and parsed</div></pre></td></tr></table></figure>
</li>
<li><p>ä¸Šè¿°ä¾‹å­ç”¨promiseé‡å†™</p>
<blockquote>
<p>ç”±äºPromiseä¿è¯äº†æ¯æ¬¡è°ƒç”¨éƒ½æ˜¯ä»¥å¼‚æ­¥æ–¹å¼è¿›è¡Œçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å®é™…ç¼–ç ä¸­ä¸éœ€è¦è°ƒç”¨ setTimeout æ¥è‡ªå·±å®ç°å¼‚æ­¥è°ƒç”¨ã€‚</p>
</blockquote>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> <span class="function"><span class="title">onReadyPromise</span></span>() &#123;</div><div class="line">    <span class="built_in">return</span> new Promise(<span class="keyword">function</span> (resolve, reject) &#123;</div><div class="line">        var readyState = document.readyState;</div><div class="line">        <span class="keyword">if</span> (readyState === <span class="string">'interactive'</span> || readyState === <span class="string">'complete'</span>) &#123;</div><div class="line">            resolve();</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            window.addEventListener(<span class="string">'DOMContentLoaded'</span>, resolve);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line">onReadyPromise().then(<span class="function"><span class="title">function</span></span> () &#123;</div><div class="line">    console.log(<span class="string">'DOM fully loaded and parsed'</span>);</div><div class="line">&#125;);</div><div class="line">console.log(<span class="string">'==Starting=='</span>);</div></pre></td></tr></table></figure>
<p>å¯¹äºä¸ºä»€ä¹ˆè¯·çœ‹<a href="http://effectivejs.com/" target="_blank" rel="external">è¿™é‡Œ</a>.</p>
<h3 id="promise-chain"><a href="#promise-chain" class="headerlink" title="promise chain"></a>promise chain</h3><ul>
<li>åŸºæœ¬ç”¨æ³•<blockquote>
<p>åœ¨æœ¬ä¾‹ä¸­æˆ‘ä»¬åœ¨taskAä¸­ä½¿ç”¨äº† throw æ–¹æ³•æ•…æ„åˆ¶é€ äº†ä¸€ä¸ªå¼‚å¸¸ã€‚ä½†åœ¨å®é™…ä¸­æƒ³ä¸»åŠ¨è¿›è¡ŒonRejectedè°ƒç”¨çš„æ—¶å€™ï¼Œåº”è¯¥è¿”å›ä¸€ä¸ªRejectedçŠ¶æ€çš„promiseå¯¹è±¡ã€‚</p>
</blockquote>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> <span class="function"><span class="title">taskA</span></span>() &#123;</div><div class="line">    console.log(<span class="string">"Task A"</span>);</div><div class="line">    throw new Error(<span class="string">"throw Error @ Task A"</span>)</div><div class="line">&#125;</div><div class="line"><span class="keyword">function</span> <span class="function"><span class="title">taskB</span></span>() &#123;</div><div class="line">    console.log(<span class="string">"Task B"</span>);// ä¸ä¼šè¢«è°ƒç”¨</div><div class="line">&#125;</div><div class="line"><span class="keyword">function</span> onRejected(error) &#123;</div><div class="line">    console.log(error);// =<span class="arrow-right">&gt;</span> <span class="string">"throw Error @ Task A"</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">function</span> <span class="function"><span class="title">finalTask</span></span>() &#123;</div><div class="line">    console.log(<span class="string">"Final Task"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">var promise = Promise.resolve();</div><div class="line">promise</div><div class="line">    .then(taskA)</div><div class="line">    .then(taskB)</div><div class="line">    .catch(onRejected)</div><div class="line">    .then(finalTask);</div><div class="line">//æ§åˆ¶å°æ‰“å°</div><div class="line">Task A</div><div class="line">Error: throw Error @ Task A</div><div class="line">Final Task</div></pre></td></tr></table></figure>
<ul>
<li>promise chain ä¸­å¦‚ä½•ä¼ é€’å‚æ•°<blockquote>
<p>å‰é¢ä¾‹å­ä¸­çš„Taskéƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œåªæ˜¯è¢«ç®€å•è°ƒç”¨è€Œå·²ã€‚<br>è¿™æ—¶å€™å¦‚æœ Task A æƒ³ç»™ Task B ä¼ é€’ä¸€ä¸ªå‚æ•°è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ<br>ç­”æ¡ˆéå¸¸ç®€å•ï¼Œé‚£å°±æ˜¯åœ¨ Task A ä¸­ return çš„è¿”å›å€¼ï¼Œä¼šåœ¨ Task B æ‰§è¡Œæ—¶ä¼ ç»™å®ƒã€‚</p>
</blockquote>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> doubleUp(value) &#123;</div><div class="line">    <span class="built_in">return</span> value * 2;</div><div class="line">&#125;</div><div class="line"><span class="keyword">function</span> increment(value) &#123;</div><div class="line">    <span class="built_in">return</span> value + 1;</div><div class="line">&#125;</div><div class="line"><span class="keyword">function</span> output(value) &#123;</div><div class="line">    console.log(value);// =<span class="arrow-right">&gt;</span> (1 + 1) * 2</div><div class="line">&#125;</div><div class="line"></div><div class="line">var promise = Promise.resolve(1);</div><div class="line">promise</div><div class="line">    .then(increment)</div><div class="line">    .then(doubleUp)</div><div class="line">    .then(output)</div><div class="line">    .catch(<span class="keyword">function</span>(error)&#123;</div><div class="line">        // promise chainä¸­å‡ºç°å¼‚å¸¸çš„æ—¶å€™ä¼šè¢«è°ƒç”¨</div><div class="line">        console.error(error);</div><div class="line">    &#125;);</div></pre></td></tr></table></figure>
<h3 id="Promise-catch"><a href="#Promise-catch" class="headerlink" title="Promise.catch()"></a>Promise.catch()</h3><blockquote>
<p>å®é™…ä¸Š Promise#catch åªæ˜¯ promise.then(undefined, onRejected); æ–¹æ³•çš„ä¸€ä¸ªåˆ«åè€Œå·²ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨æ¥æ³¨å†Œå½“promiseå¯¹è±¡çŠ¶æ€å˜ä¸ºRejectedæ—¶çš„å›è°ƒå‡½æ•°ã€‚</p>
</blockquote>
<p><strong>åœ¨ECMAScript 3ä¸­ä¿ç•™å­—æ˜¯ä¸èƒ½ä½œä¸ºå¯¹è±¡çš„å±æ€§åä½¿ç”¨çš„ã€‚ è€ŒIE8åŠä»¥ä¸‹ç‰ˆæœ¬éƒ½æ˜¯åŸºäºECMAScript 3å®ç°çš„ï¼Œå› æ­¤ä¸èƒ½å°† catch ä½œä¸ºå±æ€§æ¥ä½¿ç”¨ï¼Œä¹Ÿå°±ä¸èƒ½ç¼–å†™ç±»ä¼¼ promise.catch() çš„ä»£ç ï¼Œå› æ­¤å°±å‡ºç°äº† identifier not found è¿™ç§è¯­æ³•é”™è¯¯äº†ã€‚<br>è€Œç°åœ¨çš„æµè§ˆå™¨éƒ½æ˜¯åŸºäºECMAScript 5çš„ï¼Œè€Œåœ¨ECMAScript 5ä¸­ä¿ç•™å­—éƒ½å±äº IdentifierName ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå±æ€§åä½¿ç”¨äº†ã€‚</strong><br><mark>è§£å†³Promise#catchæ ‡è¯†ç¬¦å†²çªé—®é¢˜</mark></p>
<ul>
<li><p>ä½¿ç”¨<code>[]</code>è€Œä¸ä½¿ç”¨<code>.</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var promise = Promise.reject(new Error(<span class="string">"message"</span>));</div><div class="line">promise[<span class="string">"catch"</span>](<span class="keyword">function</span> (error) &#123;</div><div class="line">    console.error(error);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
<li><p>ä½¿ç”¨ thenä¹Ÿæ˜¯å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜çš„</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var promise = Promise.reject(new Error(<span class="string">"message"</span>));</div><div class="line">promise.then(undefined, <span class="keyword">function</span> (error) &#123;</div><div class="line">    console.error(error);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="æ¯æ¬¡è°ƒç”¨thenéƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°åˆ›å»ºçš„promiseå¯¹è±¡"><a href="#æ¯æ¬¡è°ƒç”¨thenéƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°åˆ›å»ºçš„promiseå¯¹è±¡" class="headerlink" title="æ¯æ¬¡è°ƒç”¨thenéƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°åˆ›å»ºçš„promiseå¯¹è±¡"></a>æ¯æ¬¡è°ƒç”¨thenéƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°åˆ›å»ºçš„promiseå¯¹è±¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">// 1: å¯¹åŒä¸€ä¸ªpromiseå¯¹è±¡åŒæ—¶è°ƒç”¨ `<span class="keyword">then</span>` æ–¹æ³•</div><div class="line">var aPromise = new Promise(<span class="keyword">function</span> (resolve) &#123;</div><div class="line">    resolve(100);</div><div class="line">&#125;);</div><div class="line">aPromise.then(<span class="keyword">function</span> (value) &#123;</div><div class="line">    <span class="built_in">return</span> value * 2;</div><div class="line">&#125;);</div><div class="line">aPromise.then(<span class="keyword">function</span> (value) &#123;</div><div class="line">    <span class="built_in">return</span> value * 2;</div><div class="line">&#125;);</div><div class="line">aPromise.then(<span class="keyword">function</span> (value) &#123;</div><div class="line">    console.log(<span class="string">"1: "</span> + value); // =<span class="arrow-right">&gt;</span> 100</div><div class="line">&#125;)</div><div class="line"></div><div class="line">// vs</div><div class="line"></div><div class="line">// 2: å¯¹ `<span class="keyword">then</span>` è¿›è¡Œ promise chain æ–¹å¼è¿›è¡Œè°ƒç”¨</div><div class="line">var bPromise = new Promise(<span class="keyword">function</span> (resolve) &#123;</div><div class="line">    resolve(100);</div><div class="line">&#125;);</div><div class="line">bPromise.then(<span class="keyword">function</span> (value) &#123;</div><div class="line">    <span class="built_in">return</span> value * 2;</div><div class="line">&#125;).then(<span class="keyword">function</span> (value) &#123;</div><div class="line">    <span class="built_in">return</span> value * 2;</div><div class="line">&#125;).then(<span class="keyword">function</span> (value) &#123;</div><div class="line">    console.log(<span class="string">"2: "</span> + value); // =<span class="arrow-right">&gt;</span> 100 * 2 * 2</div><div class="line">&#125;);</div><div class="line"></div><div class="line">//æ§åˆ¶å°æ‰“å°</div><div class="line">1,100</div><div class="line">2,400</div></pre></td></tr></table></figure>
<blockquote>
<p>å¦‚æœæˆ‘ä»¬çŸ¥é“äº† <code>then</code> æ–¹æ³•æ¯æ¬¡éƒ½ä¼šåˆ›å»ºå¹¶è¿”å›ä¸€ä¸ª<code>æ–°</code>çš„promiseå¯¹è±¡çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åº”è¯¥ä¸éš¾ç†è§£ä¸‹é¢ä»£ç ä¸­å¯¹<code>then</code> çš„ä½¿ç”¨æ–¹å¼ä¸Šçš„å·®åˆ«äº†</p>
</blockquote>
<p><mark>thenä¸€ä¸ªå¾ˆé‡è¦çš„åä¾‹</mark><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> <span class="function"><span class="title">badAsyncCall</span></span>() &#123;</div><div class="line">    var promise = Promise.resolve();</div><div class="line">    promise.then(<span class="function"><span class="title">function</span></span>() &#123;</div><div class="line">        // ä»»æ„å¤„ç†</div><div class="line">        <span class="built_in">return</span> newVar;</div><div class="line">    &#125;);</div><div class="line">    <span class="built_in">return</span> promise;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™ç§å†™æ³•æœ‰å¾ˆå¤šé—®é¢˜ï¼Œé¦–å…ˆåœ¨ <code>promise.then</code> ä¸­äº§ç”Ÿçš„å¼‚å¸¸ä¸ä¼šè¢«å¤–éƒ¨æ•è·ï¼Œæ­¤å¤–ï¼Œä¹Ÿä¸èƒ½å¾—åˆ° <code>then</code> çš„è¿”å›å€¼ï¼Œå³ä½¿å…¶æœ‰è¿”å›å€¼ã€‚</p>
<p>ç”±äºæ¯æ¬¡ promise.then è°ƒç”¨éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°åˆ›å»ºçš„promiseå¯¹è±¡ï¼Œå› æ­¤éœ€è¦åƒä¸Šè¿°æ–¹å¼2é‚£æ ·ï¼Œé‡‡ç”¨promise chainçš„æ–¹å¼å°†è°ƒç”¨è¿›è¡Œé“¾å¼åŒ–ï¼Œä¿®æ”¹åçš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><mark>æ­£ç¡®å†™æ³•</mark><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> <span class="function"><span class="title">anAsyncCall</span></span>() &#123;</div><div class="line">    var promise = Promise.resolve();</div><div class="line">    <span class="built_in">return</span> promise.then(<span class="function"><span class="title">function</span></span>() &#123;</div><div class="line">        // ä»»æ„å¤„ç†</div><div class="line">        <span class="built_in">return</span> newVar;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="Promise-all"><a href="#Promise-all" class="headerlink" title="Promise.all()"></a>Promise.all()</h3><p><code>Promise.all</code> æ¥æ”¶ä¸€ä¸ª <code>promiseå¯¹è±¡çš„æ•°ç»„</code>ä½œä¸ºå‚æ•°ï¼Œå½“è¿™ä¸ªæ•°ç»„é‡Œçš„æ‰€æœ‰promiseå¯¹è±¡å…¨éƒ¨å˜ä¸º<code>resolve</code>æˆ–<code>reject</code>çŠ¶æ€çš„æ—¶å€™ï¼Œå®ƒæ‰ä¼šå»è°ƒç”¨ <code>.then</code> æ–¹æ³•ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> getURL(URL) &#123;</div><div class="line">    <span class="built_in">return</span> new Promise(<span class="keyword">function</span> (resolve, reject) &#123;</div><div class="line">        var req = new XMLHttpRequest();</div><div class="line">        req.open(<span class="string">'GET'</span>, URL, <span class="literal">true</span>);</div><div class="line">        req.onload = <span class="function"><span class="title">function</span></span> () &#123;</div><div class="line">            <span class="keyword">if</span> (req.status === 200) &#123;</div><div class="line">                resolve(req.responseText);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                reject(new Error(req.statusText));</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        req.onerror = <span class="function"><span class="title">function</span></span> () &#123;</div><div class="line">            reject(new Error(req.statusText));</div><div class="line">        &#125;;</div><div class="line">        req.send();</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line">var request = &#123;</div><div class="line">        comment: <span class="keyword">function</span> <span class="function"><span class="title">getComment</span></span>() &#123;</div><div class="line">            <span class="built_in">return</span> getURL(<span class="string">'http://azu.github.io/promises-book/json/comment.json'</span>).then(JSON.parse);</div><div class="line">        &#125;,</div><div class="line">        people: <span class="keyword">function</span> <span class="function"><span class="title">getPeople</span></span>() &#123;</div><div class="line">            <span class="built_in">return</span> getURL(<span class="string">'http://azu.github.io/promises-book/json/people.json'</span>).then(JSON.parse);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"><span class="keyword">function</span> <span class="function"><span class="title">main</span></span>() &#123;</div><div class="line">    //ä¸é‡‡ç”¨all</div><div class="line">    /**</div><div class="line">    <span class="keyword">function</span> recordValue(results, value) &#123;</div><div class="line">        results.push(value);</div><div class="line">        <span class="built_in">return</span> results;</div><div class="line">    &#125;</div><div class="line">    // [] ç”¨æ¥ä¿å­˜åˆå§‹åŒ–çš„å€¼</div><div class="line">    var pushValue = recordValue.bind(null, []);</div><div class="line">    <span class="built_in">return</span> request.comment().then(pushValue).then(request.people).then(pushValue);</div><div class="line">    **/</div><div class="line">    <span class="built_in">return</span> Promise.all([request.comment(), request.people()]);</div><div class="line">&#125;</div><div class="line">// è¿è¡Œç¤ºä¾‹</div><div class="line">main().then(<span class="keyword">function</span> (value) &#123;</div><div class="line">    console.log(value);</div><div class="line">&#125;).catch(<span class="keyword">function</span>(error)&#123;</div><div class="line">    console.log(error);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ<code>request.comment()</code>å’Œ <code>request.people()</code> ä¼šåŒæ—¶å¼€å§‹æ‰§è¡Œï¼Œè€Œä¸”æ¯ä¸ªpromiseçš„ç»“æœï¼ˆresolveæˆ–rejectæ—¶ä¼ é€’çš„å‚æ•°å€¼ï¼‰ï¼Œå’Œä¼ é€’ç»™ Promise.all çš„promiseæ•°ç»„çš„<code>é¡ºåºæ˜¯ä¸€è‡´</code>çš„ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ—¶å€™<code>.then</code> å¾—åˆ°çš„promiseæ•°ç»„çš„æ‰§è¡Œç»“æœçš„é¡ºåºæ˜¯<code>å›ºå®š</code>çš„ï¼Œå³<code>[comment, people]</code>ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">main().then(<span class="keyword">function</span> (results) &#123;</div><div class="line">    console.log(results); // æŒ‰ç…§[comment, people]çš„é¡ºåº</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>æ —å­ğŸŒ°</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">// `delay`æ¯«ç§’åæ‰§è¡Œresolve</div><div class="line"><span class="keyword">function</span> timerPromisefy(delay) &#123;</div><div class="line">    <span class="built_in">return</span> new Promise(<span class="keyword">function</span> (resolve) &#123;</div><div class="line">        <span class="built_in">set</span>Timeout(<span class="function"><span class="title">function</span></span> () &#123;</div><div class="line">            resolve(delay);</div><div class="line">        &#125;, delay);</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line">var startDate = Date.now();</div><div class="line">// æ‰€æœ‰promiseå˜ä¸ºresolveåç¨‹åºé€€å‡º</div><div class="line">Promise.all([</div><div class="line">    timerPromisefy(1),</div><div class="line">    timerPromisefy(32),</div><div class="line">    timerPromisefy(64),</div><div class="line">    timerPromisefy(128)</div><div class="line">]).then(<span class="keyword">function</span> (values) &#123;</div><div class="line">    console.log(Date.now() - startDate + <span class="string">'ms'</span>);</div><div class="line">    // ç´„128ms</div><div class="line">    console.log(values);    // [1,32,64,128]</div><div class="line">&#125;);</div><div class="line">//å¯ç”¨äºå¤šä¸ªè¯·æ±‚ä¹‹åï¼Œå…³é—­å¼¹å‡ºæ¡†ä¹‹ç±»çš„ä¸šåŠ¡</div></pre></td></tr></table></figure>
<h3 id="Promise-race"><a href="#Promise-race" class="headerlink" title="Promise.race()"></a>Promise.race()</h3><p><code>Promise.all</code> åœ¨æ¥æ”¶åˆ°çš„æ‰€æœ‰çš„å¯¹è±¡promiseéƒ½å˜ä¸º FulFilled æˆ–è€… Rejected çŠ¶æ€ä¹‹åæ‰ä¼šç»§ç»­è¿›è¡Œåé¢çš„å¤„ç†ï¼Œ ä¸ä¹‹ç›¸å¯¹çš„æ˜¯ <code>Promise.race</code> åªè¦æœ‰ä¸€ä¸ªpromiseå¯¹è±¡è¿›å…¥ FulFilled æˆ–è€… Rejected çŠ¶æ€çš„è¯ï¼Œå°±ä¼šç»§ç»­è¿›è¡Œåé¢çš„å¤„ç†ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">// `delay`æ¯«ç§’åæ‰§è¡Œresolve</div><div class="line"><span class="keyword">function</span> timerPromisefy(delay) &#123;</div><div class="line">    <span class="built_in">return</span> new Promise(<span class="keyword">function</span> (resolve) &#123;</div><div class="line">        <span class="built_in">set</span>Timeout(<span class="function"><span class="title">function</span></span> () &#123;</div><div class="line">            resolve(delay);</div><div class="line">        &#125;, delay);</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line">// ä»»ä½•ä¸€ä¸ªpromiseå˜ä¸ºresolveæˆ–reject çš„è¯ç¨‹åºå°±åœæ­¢è¿è¡Œ</div><div class="line">Promise.race([</div><div class="line">    timerPromisefy(1),</div><div class="line">    timerPromisefy(32),</div><div class="line">    timerPromisefy(64),</div><div class="line">    timerPromisefy(128)</div><div class="line">]).then(<span class="keyword">function</span> (value) &#123;</div><div class="line">    console.log(value);    // =<span class="arrow-right">&gt;</span> 1</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">var winnerPromise = new Promise(<span class="keyword">function</span> (resolve) &#123;</div><div class="line">        <span class="built_in">set</span>Timeout(<span class="function"><span class="title">function</span></span> () &#123;</div><div class="line">            console.log(<span class="string">'this is winner'</span>);</div><div class="line">            resolve(<span class="string">'this is winner'</span>);</div><div class="line">        &#125;, 4);</div><div class="line">    &#125;);</div><div class="line">var loserPromise = new Promise(<span class="keyword">function</span> (resolve) &#123;</div><div class="line">        <span class="built_in">set</span>Timeout(<span class="function"><span class="title">function</span></span> () &#123;</div><div class="line">            console.log(<span class="string">'this is loser'</span>);</div><div class="line">            resolve(<span class="string">'this is loser'</span>);</div><div class="line">        &#125;, 1000);</div><div class="line">    &#125;);</div><div class="line">// ç¬¬ä¸€ä¸ªpromiseå˜ä¸ºresolveåç¨‹åºåœæ­¢</div><div class="line">Promise.race([winnerPromise, loserPromise]).then(<span class="keyword">function</span> (value) &#123;</div><div class="line">    console.log(value);    // =<span class="arrow-right">&gt;</span> <span class="string">'this is winner'</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><code>Promise.race</code>å¹¶ä¸ä¼šåœ¨ç¬¬ä¸€ä¸ªpromiseå˜ä¸ºFulfilledæ—¶ï¼Œå–æ¶ˆå…¶ä»–promiseçš„è¿è¡Œï¼Œ<del>ä½†æ˜¯resolveçš„ç»“æœå´æ˜¯åªæœ‰ç¬¬ä¸€ä¸ªçš„ï¼Œèµ›è·‘èµ›è·‘ï¼‰</del></p>
<h3 id="ä¸èƒ½è¿›è¡Œé”™è¯¯å¤„ç†çš„onRejected"><a href="#ä¸èƒ½è¿›è¡Œé”™è¯¯å¤„ç†çš„onRejected" class="headerlink" title="ä¸èƒ½è¿›è¡Œé”™è¯¯å¤„ç†çš„onRejected"></a>ä¸èƒ½è¿›è¡Œé”™è¯¯å¤„ç†çš„onRejected</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> throwError(value) &#123;</div><div class="line">    // æŠ›å‡ºå¼‚å¸¸</div><div class="line">    throw new Error(value);</div><div class="line">&#125;</div><div class="line">// <span class="arrow-left">&lt;</span>1<span class="arrow-right">&gt;</span> onRejectedä¸ä¼šè¢«è°ƒç”¨</div><div class="line"><span class="keyword">function</span> badMain(onRejected) &#123;</div><div class="line">    <span class="built_in">return</span> Promise.resolve(42).then(throwError, onRejected);</div><div class="line">&#125;</div><div class="line">// <span class="arrow-left">&lt;</span>2<span class="arrow-right">&gt;</span> æœ‰å¼‚å¸¸å‘ç”Ÿæ—¶onRejectedä¼šè¢«è°ƒç”¨</div><div class="line"><span class="keyword">function</span> goodMain(onRejected) &#123;</div><div class="line">    <span class="built_in">return</span> Promise.resolve(42).then(throwError).catch(onRejected);</div><div class="line">&#125;</div><div class="line">// è¿è¡Œç¤ºä¾‹</div><div class="line">badMain(<span class="function"><span class="title">function</span></span>()&#123;</div><div class="line">    console.log(<span class="string">"BAD"</span>);</div><div class="line">&#125;);</div><div class="line">goodMain(<span class="function"><span class="title">function</span></span>()&#123;</div><div class="line">    console.log(<span class="string">"GOOD"</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<blockquote>
<p>ä¸ºä»€ä¹ˆè¯´ <code>badMain</code> ä¸å¥½å‘¢ï¼Ÿï¼Œå› ä¸ºè™½ç„¶æˆ‘ä»¬åœ¨<code>.then</code> çš„ç¬¬äºŒä¸ªå‚æ•°ä¸­æŒ‡å®šäº†ç”¨æ¥é”™è¯¯å¤„ç†çš„å‡½æ•°ï¼Œä½†å®é™…ä¸Šå®ƒå´ä¸èƒ½æ•è·ç¬¬ä¸€ä¸ªå‚æ•° <code>onFulfilled</code> æŒ‡å®šçš„å‡½æ•°ï¼ˆæœ¬ä¾‹ä¸º <code>throwError</code> ï¼‰é‡Œé¢å‡ºç°çš„é”™è¯¯ã€‚<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ—¶å€™å³ä½¿ <code>throwError</code> æŠ›å‡ºäº†å¼‚å¸¸ï¼ŒonRejected æŒ‡å®šçš„å‡½æ•°ä¹Ÿä¸ä¼šè¢«è°ƒç”¨ï¼ˆå³ä¸ä¼šè¾“å‡º<code>&quot;BAD&quot;</code>å­—æ ·ï¼‰ã€‚<br>ä¸æ­¤ç›¸å¯¹çš„æ˜¯ï¼Œ <code>goodMain</code> çš„ä»£ç åˆ™éµå¾ªäº† <code>throwErrorâ†’onRejected</code> çš„è°ƒç”¨æµç¨‹ã€‚ è¿™æ—¶å€™ <code>throwError</code> ä¸­å‡ºç°å¼‚å¸¸çš„è¯ï¼Œåœ¨ä¼šè¢«æ–¹æ³•é“¾ä¸­çš„ä¸‹ä¸€ä¸ªæ–¹æ³•ï¼Œå³ <code>.catch</code> æ‰€æ•è·ï¼Œè¿›è¡Œç›¸åº”çš„é”™è¯¯å¤„ç†ã€‚</p>
</blockquote>
<p><strong>æˆ‘ä»¬éœ€è¦æ³¨æ„å¦‚æœä»£ç ç±»ä¼¼ badMain é‚£æ ·çš„è¯ï¼Œå°±å¯èƒ½å‡ºç°ç¨‹åºä¸ä¼šæŒ‰é¢„æœŸè¿è¡Œçš„æƒ…å†µï¼Œä»è€Œä¸èƒ½æ­£ç¡®çš„è¿›è¡Œé”™è¯¯å¤„ç†ã€‚</strong></p>
<h3 id="ç®€å•çš„thenable"><a href="#ç®€å•çš„thenable" class="headerlink" title="ç®€å•çš„thenable"></a>ç®€å•çš„thenable</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">// è¿”å› `thenable`</div><div class="line"><span class="keyword">function</span> notifyMessageAsThenable(message, options) &#123;</div><div class="line">    <span class="built_in">return</span> &#123;</div><div class="line">        <span class="string">'then'</span>: <span class="keyword">function</span> (resolve, reject) &#123;</div><div class="line">            notifyMessage(message, options, <span class="keyword">function</span> (error, notification) &#123;</div><div class="line">                <span class="keyword">if</span> (error) &#123;</div><div class="line">                    reject(error);</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    resolve(notification);</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">&#125;</div><div class="line">// è¿è¡Œç¤ºä¾‹</div><div class="line">Promise.resolve(notifyMessageAsThenable(<span class="string">"message"</span>)).then(<span class="keyword">function</span> (notification) &#123;</div><div class="line">    console.log(notification);// é€šçŸ¥å¯¹è±¡</div><div class="line">&#125;).catch(<span class="keyword">function</span>(error)&#123;</div><div class="line">    console.error(error);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="Deferredå’ŒPromiseçš„å…³ç³»"><a href="#Deferredå’ŒPromiseçš„å…³ç³»" class="headerlink" title="Deferredå’ŒPromiseçš„å…³ç³»"></a>Deferredå’ŒPromiseçš„å…³ç³»</h3><p><img src="http://liubin.org/promises-book/Ch4_AdvancedPromises/img/deferred-and-promise.png" alt="image"></p>
<h3 id="è®©Promiseç­‰å¾…æŒ‡å®šæ—¶é—´"><a href="#è®©Promiseç­‰å¾…æŒ‡å®šæ—¶é—´" class="headerlink" title="è®©Promiseç­‰å¾…æŒ‡å®šæ—¶é—´"></a>è®©Promiseç­‰å¾…æŒ‡å®šæ—¶é—´</h3><ul>
<li><p>ç®€å•çš„ğŸŒ°</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> delayPromise(ms)&#123;</div><div class="line">    <span class="built_in">return</span> new Promise(<span class="function"><span class="title">function</span></span>()&#123;</div><div class="line">        <span class="built_in">set</span>Timeout(resolve,ms);</div><div class="line">    &#125;)</div><div class="line">&#125;</div><div class="line">//æ —å­ğŸŒ°</div><div class="line">delayPromise(100).then(<span class="function"><span class="title">function</span></span>()&#123;</div><div class="line">    alert(<span class="string">'å·²ç»å»¶è¿Ÿ100ms'</span>)</div><div class="line">)</div></pre></td></tr></table></figure>
</li>
<li><p>Promise.raceä¸­çš„è¶…æ—¶</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> delayPromise(ms) &#123;</div><div class="line">    <span class="built_in">return</span> new Promise(<span class="keyword">function</span> (resolve) &#123;</div><div class="line">        <span class="built_in">set</span>Timeout(resolve, ms);</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"><span class="keyword">function</span> timeoutPromise(promise, ms) &#123;</div><div class="line">    var timeout = delayPromise(ms).then(<span class="function"><span class="title">function</span></span> () &#123;</div><div class="line">            throw new Error(<span class="string">'Operation timed out after '</span> + ms + <span class="string">' ms'</span>);</div><div class="line">        &#125;);</div><div class="line">    <span class="built_in">return</span> Promise.race([promise, timeout]);</div><div class="line">&#125;</div><div class="line">// è¿è¡Œç¤ºä¾‹</div><div class="line">var taskPromise = new Promise(<span class="keyword">function</span>(resolve)&#123;</div><div class="line">    // éšä¾¿ä¸€äº›ä»€ä¹ˆå¤„ç†</div><div class="line">    var delay = Math.random() * 2000;</div><div class="line">    <span class="built_in">set</span>Timeout(<span class="function"><span class="title">function</span></span>()&#123;</div><div class="line">        resolve(delay + <span class="string">"ms"</span>);</div><div class="line">    &#125;, delay);</div><div class="line">&#125;);</div><div class="line">timeoutPromise(taskPromise, 1000).then(<span class="keyword">function</span>(value)&#123;</div><div class="line">    console.log(<span class="string">"taskPromiseåœ¨è§„å®šæ—¶é—´å†…ç»“æŸ : "</span> + value);</div><div class="line">&#125;).catch(<span class="keyword">function</span>(error)&#123;</div><div class="line">    console.log(<span class="string">"å‘ç”Ÿè¶…æ—¶"</span>, error);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><a href="http://liubin.org/promises-book/#promises-aplus" target="_blank" rel="external"></a></p>

      
    </div>
    
    <footer>
        <div class="alignright">
          
          <a href='javascript:void(0)' class="share-link bdsharebuttonbox" data-cmd="more">åˆ†äº«</a>
        </div>
        
  
  <div class="categories">
    <a href="/categories/ES6/">ES6</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/ES6/">ES6</a>, <a href="/tags/promise/">promise</a>
  </div>

        <!-- partial('post/share') -->
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="æœç´¢">
    <input type="hidden" name="q" value="site:www.supernever.com">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">åˆ†ç±»</h3>
  <ul class="entry">
  
    <li><a href="/categories/ES6/">ES6</a><small>10</small></li>
  
    <li><a href="/categories/å‰ç«¯/">å‰ç«¯</a><small>21</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">æœ€æ–°æ–‡ç« </h3>
  <ul class="entry">
    
      <li>
        <a href="/2017/11/10/box-sizing/">box-sizing</a>
      </li>
    
      <li>
        <a href="/2017/11/10/flex/">flex</a>
      </li>
    
      <li>
        <a href="/2017/07/10/javascriptåŸºç¡€-Array/">javascriptåŸºç¡€-Array</a>
      </li>
    
      <li>
        <a href="/2017/03/28/node-assert/">node_assert</a>
      </li>
    
      <li>
        <a href="/2017/03/03/async-await/">async-await</a>
      </li>
    
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">æ ‡ç­¾</h3>
  <ul class="entry">
  
    <li><a href="/tags/Array/">Array</a><small>1</small></li>
  
    <li><a href="/tags/DOM/">DOM</a><small>2</small></li>
  
    <li><a href="/tags/DOM-EDIT/">DOM-EDIT</a><small>1</small></li>
  
    <li><a href="/tags/ES6/">ES6</a><small>9</small></li>
  
    <li><a href="/tags/JavaScript/">JavaScript</a><small>2</small></li>
  
    <li><a href="/tags/MySql/">MySql</a><small>1</small></li>
  
    <li><a href="/tags/Symbol/">Symbol</a><small>1</small></li>
  
    <li><a href="/tags/assert/">assert</a><small>1</small></li>
  
    <li><a href="/tags/bind/">bind</a><small>1</small></li>
  
    <li><a href="/tags/box-sizing/">box-sizing</a><small>1</small></li>
  
    <li><a href="/tags/carousel/">carousel</a><small>1</small></li>
  
    <li><a href="/tags/css/">css</a><small>1</small></li>
  
    <li><a href="/tags/css-selector/">css-selector</a><small>1</small></li>
  
    <li><a href="/tags/css3/">css3</a><small>2</small></li>
  
    <li><a href="/tags/flex/">flex</a><small>1</small></li>
  
    <li><a href="/tags/generator/">generator</a><small>1</small></li>
  
    <li><a href="/tags/getBoundingClientRect/">getBoundingClientRect</a><small>1</small></li>
  
    <li><a href="/tags/git/">git</a><small>1</small></li>
  
    <li><a href="/tags/html/">html</a><small>2</small></li>
  
    <li><a href="/tags/http/">http</a><small>1</small></li>
  
    <li><a href="/tags/javascript/">javascript</a><small>10</small></li>
  
    <li><a href="/tags/jquery/">jquery</a><small>1</small></li>
  
    <li><a href="/tags/jquery-noConflict/">jquery-noConflict</a><small>1</small></li>
  
    <li><a href="/tags/js-es6/">js-es6</a><small>2</small></li>
  
    <li><a href="/tags/js-proto/">js__proto__</a><small>1</small></li>
  
    <li><a href="/tags/jså†’æ³¡/">jså†’æ³¡</a><small>1</small></li>
  
    <li><a href="/tags/knockout-js/">knockout.js</a><small>4</small></li>
  
    <li><a href="/tags/map/">map</a><small>2</small></li>
  
    <li><a href="/tags/media-query/">media-query</a><small>1</small></li>
  
    <li><a href="/tags/mime/">mime</a><small>1</small></li>
  
    <li><a href="/tags/mobx/">mobx</a><small>1</small></li>
  
    <li><a href="/tags/nodejs/">nodejs</a><small>1</small></li>
  
    <li><a href="/tags/promise/">promise</a><small>1</small></li>
  
    <li><a href="/tags/react/">react</a><small>1</small></li>
  
    <li><a href="/tags/react-life/">react-life</a><small>1</small></li>
  
    <li><a href="/tags/reduce/">reduce</a><small>1</small></li>
  
    <li><a href="/tags/regexp/">regexp</a><small>1</small></li>
  
    <li><a href="/tags/scp/">scp</a><small>1</small></li>
  
    <li><a href="/tags/set/">set</a><small>1</small></li>
  
    <li><a href="/tags/shell/">shell</a><small>3</small></li>
  
    <li><a href="/tags/tar/">tar</a><small>1</small></li>
  
    <li><a href="/tags/tool/">tool</a><small>2</small></li>
  
    <li><a href="/tags/webpack/">webpack</a><small>1</small></li>
  
    <li><a href="/tags/webpack-howto/">webpack-howto</a><small>1</small></li>
  
    <li><a href="/tags/yarn/">yarn</a><small>1</small></li>
  
    <li><a href="/tags/ä»£ç ç‰‡æ®µ/">ä»£ç ç‰‡æ®µ</a><small>1</small></li>
  
    <li><a href="/tags/å¯è§†åŒ–æ ¼å¼æ¨¡å‹/">å¯è§†åŒ–æ ¼å¼æ¨¡å‹</a><small>1</small></li>
  
    <li><a href="/tags/å°å‘½ä»¤/">å°å‘½ä»¤</a><small>1</small></li>
  
    <li><a href="/tags/æœ€åŸºæœ¬æ“ä½œ/">æœ€åŸºæœ¬æ“ä½œ</a><small>1</small></li>
  
    <li><a href="/tags/æ¨¡æ¿/">æ¨¡æ¿</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tagcloud">
  <h3 class="title">æ ‡ç­¾äº‘</h3>
  <div class="entry">
    <a href="/tags/Array/" style="font-size: 10px;">Array</a> <a href="/tags/DOM/" style="font-size: 12px;">DOM</a> <a href="/tags/DOM-EDIT/" style="font-size: 10px;">DOM-EDIT</a> <a href="/tags/ES6/" style="font-size: 18px;">ES6</a> <a href="/tags/JavaScript/" style="font-size: 12px;">JavaScript</a> <a href="/tags/MySql/" style="font-size: 10px;">MySql</a> <a href="/tags/Symbol/" style="font-size: 10px;">Symbol</a> <a href="/tags/assert/" style="font-size: 10px;">assert</a> <a href="/tags/bind/" style="font-size: 10px;">bind</a> <a href="/tags/box-sizing/" style="font-size: 10px;">box-sizing</a> <a href="/tags/carousel/" style="font-size: 10px;">carousel</a> <a href="/tags/css/" style="font-size: 10px;">css</a> <a href="/tags/css-selector/" style="font-size: 10px;">css-selector</a> <a href="/tags/css3/" style="font-size: 12px;">css3</a> <a href="/tags/flex/" style="font-size: 10px;">flex</a> <a href="/tags/generator/" style="font-size: 10px;">generator</a> <a href="/tags/getBoundingClientRect/" style="font-size: 10px;">getBoundingClientRect</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/html/" style="font-size: 12px;">html</a> <a href="/tags/http/" style="font-size: 10px;">http</a> <a href="/tags/javascript/" style="font-size: 20px;">javascript</a> <a href="/tags/jquery/" style="font-size: 10px;">jquery</a> <a href="/tags/jquery-noConflict/" style="font-size: 10px;">jquery-noConflict</a> <a href="/tags/js-es6/" style="font-size: 12px;">js-es6</a> <a href="/tags/js-proto/" style="font-size: 10px;">js__proto__</a> <a href="/tags/jså†’æ³¡/" style="font-size: 10px;">jså†’æ³¡</a> <a href="/tags/knockout-js/" style="font-size: 16px;">knockout.js</a> <a href="/tags/map/" style="font-size: 12px;">map</a> <a href="/tags/media-query/" style="font-size: 10px;">media-query</a> <a href="/tags/mime/" style="font-size: 10px;">mime</a> <a href="/tags/mobx/" style="font-size: 10px;">mobx</a> <a href="/tags/nodejs/" style="font-size: 10px;">nodejs</a> <a href="/tags/promise/" style="font-size: 10px;">promise</a> <a href="/tags/react/" style="font-size: 10px;">react</a> <a href="/tags/react-life/" style="font-size: 10px;">react-life</a> <a href="/tags/reduce/" style="font-size: 10px;">reduce</a> <a href="/tags/regexp/" style="font-size: 10px;">regexp</a> <a href="/tags/scp/" style="font-size: 10px;">scp</a> <a href="/tags/set/" style="font-size: 10px;">set</a> <a href="/tags/shell/" style="font-size: 14px;">shell</a> <a href="/tags/tar/" style="font-size: 10px;">tar</a> <a href="/tags/tool/" style="font-size: 12px;">tool</a> <a href="/tags/webpack/" style="font-size: 10px;">webpack</a> <a href="/tags/webpack-howto/" style="font-size: 10px;">webpack-howto</a> <a href="/tags/yarn/" style="font-size: 10px;">yarn</a> <a href="/tags/ä»£ç ç‰‡æ®µ/" style="font-size: 10px;">ä»£ç ç‰‡æ®µ</a> <a href="/tags/å¯è§†åŒ–æ ¼å¼æ¨¡å‹/" style="font-size: 10px;">å¯è§†åŒ–æ ¼å¼æ¨¡å‹</a> <a href="/tags/å°å‘½ä»¤/" style="font-size: 10px;">å°å‘½ä»¤</a> <a href="/tags/æœ€åŸºæœ¬æ“ä½œ/" style="font-size: 10px;">æœ€åŸºæœ¬æ“ä½œ</a> <a href="/tags/æ¨¡æ¿/" style="font-size: 10px;">æ¨¡æ¿</a>
  </div>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  <p>
  
  &copy; 2017 supernever
  
  All rights reserved.</p>
  <p>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></p>
</div>
<div class="clearfix"></div>

<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<div id='bg'></div>
</body>
</html>